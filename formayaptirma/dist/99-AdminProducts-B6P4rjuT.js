import{c as e,a as s,g as r,j as a,P as t,d as i,e as l,aj as n,n as o,s as d,J as c,aF as u,a7 as m,aG as p}from"./03-hero-critical-BKzCa96P.js";import{r as x}from"./01-react-core-DCvPBpDR.js";import{D as h,n as j,B as f,j as g,k as y,l as b,m as N,o as v,C as w,g as k,h as _,i as C,p as P}from"./04-ui-components-DpbmxBFV.js";import{F as S,a as O,b as D,c as E,d as F,e as I,f as U}from"./99-form-BQypkM9v.js";import{c as T,I as R}from"./05-admin-bundle-BW3OFzIa.js";import{L as A}from"./99-label-DtO75rKq.js";import{M as L}from"./99-multi-image-uploader-BtQB02N5.js";import{S as M,a as q,b as $,c as V,d as z}from"./99-select-CL9TI2Dz.js";import{T as B}from"./99-textarea-BOZk7JoE.js";import{u as J}from"./99-index-D5v_MFz8.js";import{c as K}from"./06-utils-QQqVvbBo.js";import{o as X,s as Y,b as G,t as H}from"./99-zod-D0J4YnXH.js";import{u as Q}from"./99-index.esm-2mfLcUez.js";import"./02-react-router-l50u7dmW.js";import"./99-image-uploader-KY2aE3Hk.js";import"./99-ensureBuckets-oAmkppU8.js";import"./99-badge-CpQK4qLU.js";import"./99-index-CxCer4qO.js";var W="Checkbox",[Z,ee]=e(W),[se,re]=Z(W),ae=x.forwardRef(((e,l)=>{const{__scopeCheckbox:n,name:o,checked:d,defaultChecked:c,required:u,disabled:m,value:p="on",onCheckedChange:h,form:j,...f}=e,[g,y]=x.useState(null),b=s(l,(e=>y(e))),N=x.useRef(!1),v=!g||j||!!g.closest("form"),[w=!1,k]=r({prop:d,defaultProp:c,onChange:h}),_=x.useRef(w);return x.useEffect((()=>{const e=null==g?void 0:g.form;if(e){const s=()=>k(_.current);return e.addEventListener("reset",s),()=>e.removeEventListener("reset",s)}}),[g,k]),a.jsxs(se,{scope:n,state:w,disabled:m,children:[a.jsx(t.button,{type:"button",role:"checkbox","aria-checked":ne(w)?"mixed":w,"aria-required":u,"data-state":oe(w),"data-disabled":m?"":void 0,disabled:m,value:p,...f,ref:b,onKeyDown:i(e.onKeyDown,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:i(e.onClick,(e=>{k((e=>!!ne(e)||!e)),v&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())}))}),v&&a.jsx(le,{control:g,bubbles:!N.current,name:o,value:p,checked:w,required:u,disabled:m,form:j,style:{transform:"translateX(-100%)"},defaultChecked:!ne(c)&&c})]})}));ae.displayName=W;var te="CheckboxIndicator",ie=x.forwardRef(((e,s)=>{const{__scopeCheckbox:r,forceMount:i,...n}=e,o=re(te,r);return a.jsx(l,{present:i||ne(o.state)||!0===o.state,children:a.jsx(t.span,{"data-state":oe(o.state),"data-disabled":o.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...e.style}})})}));ie.displayName=te;var le=e=>{const{control:s,checked:r,bubbles:t=!0,defaultChecked:i,...l}=e,n=x.useRef(null),o=J(r),d=T(s);x.useEffect((()=>{const e=n.current,s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"checked").set;if(o!==r&&a){const s=new Event("click",{bubbles:t});e.indeterminate=ne(r),a.call(e,!ne(r)&&r),e.dispatchEvent(s)}}),[o,r,t]);const c=x.useRef(!ne(r)&&r);return a.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??c.current,...l,tabIndex:-1,ref:n,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ne(e){return"indeterminate"===e}function oe(e){return ne(e)?"indeterminate":e?"checked":"unchecked"}var de=ae,ce=ie;const ue=x.forwardRef((({className:e,...s},r)=>a.jsx(de,{ref:r,className:K("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:a.jsx(ce,{className:K("flex items-center justify-center text-current"),children:a.jsx(n,{className:"h-4 w-4"})})})));ue.displayName=de.displayName;const me=[];for(let ge=0;ge<256;++ge)me.push((ge+256).toString(16).slice(1));let pe;const xe=new Uint8Array(16),he={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},je=X({name:Y().min(2,{message:"Name must be at least 2 characters."}),price:Y().refine((e=>!isNaN(Number(e))&&Number(e)>=0),{message:"Price must be a valid number."}),stock:Y().refine((e=>!isNaN(Number(e))&&Number(e)>=0),{message:"Stock must be a valid number."}),description:Y().optional(),minOrder:Y().refine((e=>!isNaN(Number(e))&&Number(e)>=0),{message:"Minimum order must be a valid number."}),colors:Y().refine((e=>!isNaN(Number(e))&&Number(e)>=0),{message:"Colors must be a valid number."}),isNew:G().default(!1),isPopular:G().default(!1),isFeatured:G().default(!1),displayOrder:Y().refine((e=>!isNaN(Number(e))),{message:"Display order must be a valid number."}),jerseyType:Y().nullable().default(null)}),fe=()=>{const[e,s]=x.useState([]),[r,t]=x.useState(!0),[i,l]=x.useState(!1),[n,T]=x.useState(null),[J,K]=x.useState([]),[X,Y]=x.useState([]),[G,W]=x.useState(1),{t:Z,language:ee}=o(),se=Q({resolver:H(je),defaultValues:{name:"",price:"0",stock:"0",description:"",minOrder:"10",colors:"1",isNew:!1,isPopular:!1,isFeatured:!1,displayOrder:"999",jerseyType:null}});x.useEffect((()=>{ae(),re()}),[]);const re=async()=>{try{const{data:e,error:s}=await d.from("jersey_types").select("*").order("name",{ascending:!0});if(s)throw s;Y(e||[])}catch(e){}},ae=async()=>{try{t(!0);const{data:e,error:r}=await d.from("products").select("*").order("display_order",{ascending:!0});if(r)throw r;s(e||[]),te()}catch(e){c.error("Failed to load products")}finally{t(!1)}},te=async()=>{try{const{data:e,error:s}=await d.from("products").select("display_id");if(s)throw s;if(e&&e.length>0){const s=Math.max(...e.map((e=>e.display_id||0)));W(s+1)}else W(1)}catch(e){c.error("Failed to load products")}},ie=()=>{se.reset({name:"",price:"0",stock:"0",description:"",minOrder:"10",colors:"1",isNew:!1,isPopular:!1,isFeatured:!1,displayOrder:"999",jerseyType:null}),T(null),K([]),l(!1)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Products"}),a.jsxs(h,{open:i,onOpenChange:l,children:[a.jsx(j,{asChild:!0,children:a.jsxs(f,{onClick:()=>ie(),children:[a.jsx(u,{className:"mr-2 h-4 w-4"})," Add Product"]})}),a.jsxs(g,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(y,{children:[a.jsx(b,{children:n?"Edit Product":"Add New Product"}),a.jsxs(N,{children:["Fill in the details for your product.",!n&&a.jsxs("span",{className:"block mt-1 text-sm font-medium",children:["A unique ID #",G," will be automatically assigned to this product."]})]})]}),a.jsx(S,{...se,children:a.jsxs("form",{onSubmit:se.handleSubmit((async e=>{try{const s=(null==n?void 0:n.id)||function(e){var s;if(he.randomUUID&&!e)return he.randomUUID();const r=(e=e||{}).random??(null==(s=e.rng)?void 0:s.call(e))??function(){if(!pe){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pe=crypto.getRandomValues.bind(crypto)}return pe(xe)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,s=0){return(me[e[s+0]]+me[e[s+1]]+me[e[s+2]]+me[e[s+3]]+"-"+me[e[s+4]]+me[e[s+5]]+"-"+me[e[s+6]]+me[e[s+7]]+"-"+me[e[s+8]]+me[e[s+9]]+"-"+me[e[s+10]]+me[e[s+11]]+me[e[s+12]]+me[e[s+13]]+me[e[s+14]]+me[e[s+15]]).toLowerCase()}(r)}();let r=J.length>0?J[0]:null;!r&&(null==n?void 0:n.image_url)&&(r=n.image_url);const a=e.name.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-|-$/g,""),t={name:e.name,price:Number(e.price),stock:Number(e.stock),image_url:r,additional_images:J.length>1?J.slice(1):[],description:e.description,min_order:e.minOrder?Number(e.minOrder):10,colors:e.colors?Number(e.colors):1,is_new:e.isNew,is_popular:e.isPopular,is_featured:e.isFeatured,display_order:e.displayOrder?Number(e.displayOrder):999,jersey_type:"null"===e.jerseyType?null:e.jerseyType,slug:a};if(n){const{error:e}=await d.from("products").update(t).eq("id",s);if(e)throw e;c.success("Product updated successfully")}else{const{error:e}=await d.from("products").insert({...t,id:s,display_id:G});if(e)throw e;c.success("Product created successfully"),W((e=>e+1))}ie(),ae()}catch(s){c.error(`Failed to save product: ${s.message}`)}})),className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(A,{children:"Product Images"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Upload multiple images. The first image will be used as the main image."}),a.jsx(L,{currentImages:J,onImagesUpdated:e=>{K(e)},bucketName:"images",folderPath:"products",maxImages:10})]}),n&&n.display_id&&a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-md border border-gray-200 dark:border-gray-700",children:a.jsxs("p",{className:"text-sm flex items-center",children:[a.jsx("span",{className:"font-medium mr-2",children:"Product ID:"}),a.jsxs("span",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded",children:["#",n.display_id]}),a.jsx("span",{className:"ml-2 text-gray-500",children:"(Cannot be changed)"})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(O,{control:se.control,name:"name",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Product Name"}),a.jsx(F,{children:a.jsx(R,{placeholder:"Product name",...e})}),a.jsx(I,{})]})}),a.jsx(O,{control:se.control,name:"price",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Price (TRY)"}),a.jsx(F,{children:a.jsx(R,{type:"number",min:"0",step:"0.01",placeholder:"0.00",...e})}),a.jsx(U,{children:"Enter price in Turkish Lira (₺). Will be converted to USD for English users."}),a.jsx(I,{})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(O,{control:se.control,name:"stock",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Stock"}),a.jsx(F,{children:a.jsx(R,{type:"number",min:"0",placeholder:"0",...e})}),a.jsx(U,{children:"Set to 0 for out of stock"}),a.jsx(I,{})]})}),a.jsx(O,{control:se.control,name:"minOrder",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Minimum Order"}),a.jsx(F,{children:a.jsx(R,{type:"number",min:"1",placeholder:"10",...e})}),a.jsx(I,{})]})}),a.jsx(O,{control:se.control,name:"colors",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Available Colors"}),a.jsx(F,{children:a.jsx(R,{type:"number",min:"1",max:"10",placeholder:"1",...e})}),a.jsx(I,{})]})})]}),a.jsx(O,{control:se.control,name:"description",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Description"}),a.jsx(F,{children:a.jsx(B,{placeholder:"Product description",className:"min-h-[100px]",...e})}),a.jsx(I,{})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(O,{control:se.control,name:"jerseyType",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Jersey Type"}),a.jsxs(M,{onValueChange:e.onChange,value:null===e.value?"null":e.value,children:[a.jsx(F,{children:a.jsx(q,{children:a.jsx($,{placeholder:"Select type"})})}),a.jsxs(V,{children:[a.jsx(z,{value:"null",children:"All Types"}),X.map((e=>a.jsx(z,{value:e.id,children:e.name},e.id)))]})]}),a.jsx(I,{})]})}),a.jsx(O,{control:se.control,name:"displayOrder",render:({field:e})=>a.jsxs(D,{children:[a.jsx(E,{children:"Display Order"}),a.jsx(F,{children:a.jsx(R,{type:"number",min:"0",placeholder:"999",...e})}),a.jsx(U,{children:"Lower numbers appear first"}),a.jsx(I,{})]})})]}),a.jsxs("div",{className:"flex flex-wrap gap-6",children:[a.jsx(O,{control:se.control,name:"isNew",render:({field:e})=>a.jsxs(D,{className:"flex flex-row items-center space-x-3 space-y-0",children:[a.jsx(F,{children:a.jsx(ue,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(E,{className:"font-normal",children:"New Product"})]})}),a.jsx(O,{control:se.control,name:"isPopular",render:({field:e})=>a.jsxs(D,{className:"flex flex-row items-center space-x-3 space-y-0",children:[a.jsx(F,{children:a.jsx(ue,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(E,{className:"font-normal",children:"Popular Product"})]})}),a.jsx(O,{control:se.control,name:"isFeatured",render:({field:e})=>a.jsxs(D,{className:"flex flex-row items-center space-x-3 space-y-0",children:[a.jsx(F,{children:a.jsx(ue,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(E,{className:"font-normal",children:"Featured Product"})]})})]}),a.jsxs(v,{children:[a.jsx(f,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),a.jsx(f,{type:"submit",children:n?"Update Product":"Create Product"})]})]})})]})]})]}),r?a.jsx("div",{className:"flex justify-center py-10",children:a.jsx(m,{className:"h-10 w-10 animate-spin text-primary"})}):a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.map((e=>{return a.jsxs(w,{className:"overflow-hidden",children:[a.jsxs("div",{className:"aspect-[4/3] relative",children:[a.jsx("img",{src:e.image_url||"/placeholder.svg",alt:e.name,className:"w-full h-full object-cover"}),e.is_new&&a.jsx("span",{className:"absolute top-2 left-2 bg-green-500 text-white text-xs py-1 px-2 rounded-full",children:"New"}),e.is_popular&&a.jsx("span",{className:"absolute top-2 right-2 bg-amber-500 text-white text-xs py-1 px-2 rounded-full",children:"Popular"}),Array.isArray(e.additional_images)&&e.additional_images.length>0&&a.jsxs("span",{className:"absolute bottom-2 right-2 bg-blue-500 text-white text-xs py-1 px-2 rounded-full flex items-center",children:[a.jsxs("span",{className:"mr-1",children:["+",e.additional_images.length]})," images"]})]}),a.jsxs(k,{children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx(_,{className:"line-clamp-1",children:e.name}),a.jsxs("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-xs font-medium px-2 py-1 rounded",children:["ID: ",e.display_id||"—"]})]}),a.jsxs(C,{children:[(s=e.price,"tr"===ee?`${s.toFixed(2)} ₺`:`$${(s/32).toFixed(2)}`)," | Min: ",e.min_order||10," ","pcs"]})]}),a.jsxs(P,{className:"flex justify-between",children:[a.jsx(f,{variant:"outline",size:"sm",onClick:()=>(e=>{var s,r,a,t,i;T(e),se.reset({name:e.name||"",price:(null==(s=e.price)?void 0:s.toString())||"0",stock:(null==(r=e.stock)?void 0:r.toString())||"0",description:e.description||"",minOrder:(null==(a=e.min_order)?void 0:a.toString())||"10",colors:(null==(t=e.colors)?void 0:t.toString())||"1",isNew:e.is_new||!1,isPopular:e.is_popular||!1,isFeatured:e.is_featured||!1,displayOrder:(null==(i=e.display_order)?void 0:i.toString())||"999",jerseyType:e.jersey_type||null});const n=[];e.image_url&&n.push(e.image_url),e.additional_images&&Array.isArray(e.additional_images)&&n.push(...e.additional_images),K(n),l(!0)})(e),children:"Edit"}),a.jsx(f,{variant:"destructive",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this product?"))try{const{error:s}=await d.from("products").delete().eq("id",e);if(s)throw s;c.success("Product deleted successfully"),ae()}catch(s){c.error("Failed to delete product")}})(e.id),children:a.jsx(p,{className:"h-4 w-4"})})]})]},e.id);var s})),0===e.length&&a.jsx("div",{className:"col-span-full text-center py-10",children:a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No products found. Add your first product!"})})]})]})};export{fe as default};
