const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["99-ensureBuckets-oAmkppU8.js","03-hero-critical-BKzCa96P.js","01-react-core-DCvPBpDR.js","02-react-router-l50u7dmW.js","06-utils-QQqVvbBo.js"])))=>i.map(i=>d[i]);
import{j as e,J as a,X as t,aK as s,a7 as r,aL as i,s as n,_ as l}from"./03-hero-critical-BKzCa96P.js";import{r as o}from"./01-react-core-DCvPBpDR.js";import{B as c,D as d,j as m,k as u,l as g,o as h}from"./04-ui-components-DpbmxBFV.js";import{I as p}from"./05-admin-bundle-BW3OFzIa.js";function x({currentImageUrl:x,onImageUploaded:y,bucketName:j="story-images",folderPath:f="images",disabled:b=!1}){const[w,k]=o.useState(!1),[v,R]=o.useState(x||null),[N,E]=o.useState(!1),[L,U]=o.useState(!1),[C,_]=o.useState("");return o.useEffect((()=>{const e=()=>{N||(async()=>{try{const e=await l((()=>import("./99-ensureBuckets-oAmkppU8.js")),__vite__mapDeps([0,1,2,3,4])).then((e=>e.ensureBucketsExist));await e();const t=await l((()=>import("./99-ensureBuckets-oAmkppU8.js")),__vite__mapDeps([0,1,2,3,4])).then((e=>e.checkBucketExists));await t("story-images")?E(!0):a.error("Required storage bucket not found. Please contact the administrator.")}catch(e){a.error("Failed to initialize storage. Please try again later.")}})()},t=document.getElementById("image-upload");if(t)return t.addEventListener("focus",e),()=>{t.removeEventListener("focus",e)}}),[N]),e.jsxs("div",{className:"w-full space-y-4",children:[v?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:v,alt:"Preview",className:"w-full h-auto object-cover rounded-md max-h-[300px]",loading:"lazy",width:"300",height:"200",onError:()=>{a.error("Resim yüklenemedi. Lütfen geçerli bir resim URL'si girin."),R(null)}}),e.jsx(c,{size:"icon",variant:"destructive",className:"absolute top-2 right-2",onClick:()=>{R(null),y("")},disabled:b,children:e.jsx(t,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-md p-6 flex flex-col items-center justify-center",children:[e.jsx(s,{className:"h-10 w-10 text-gray-400 dark:text-gray-600 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Resim Seçin veya Sürükleyin"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG veya WebP (max. 5MB)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",id:"image-upload",className:"hidden",accept:"image/*",onChange:async e=>{try{if(k(!0),!e.target.files||0===e.target.files.length)return;const t="story-images",s=e.target.files[0];let r=s;if("image/jpeg"===s.type||"image/png"===s.type){const e=new Image,a=document.createElement("canvas");await new Promise(((t,i)=>{e.onload=()=>{let n=e.width,l=e.height;const o=1200;n>o&&(l=l*o/n,n=o),a.width=n,a.height=l;const c=a.getContext("2d");c?(c.drawImage(e,0,0,n,l),a.toBlob((e=>{e?(r=new File([e],s.name,{type:s.type,lastModified:Date.now()}),t()):i(new Error("Could not compress image"))}),s.type,.8)):i(new Error("Could not get canvas context"))},e.onerror=()=>{i(new Error("Could not load image"))},e.src=URL.createObjectURL(s)})).catch((e=>{r=s}))}const i=r.name.split(".").pop(),l=`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${i}`,o=`${f}/${l}`,{error:c,data:d}=await n.storage.from(t).upload(o,r);if(c)throw c;const{data:m}=n.storage.from(t).getPublicUrl(o),u=m.publicUrl;R(u),y(u),a.success("Resim başarıyla yüklendi")}catch(t){a.error("Resim yüklenirken bir hata oluştu")}finally{k(!1)}},disabled:w||b}),e.jsx(c,{type:"button",variant:v?"outline":"default",className:"flex-1",onClick:()=>{var e;return null==(e=document.getElementById("image-upload"))?void 0:e.click()},disabled:w||b,children:w?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"mr-2 h-4 w-4 animate-spin"}),"Yükleniyor..."]}):v?"Resmi Değiştir":"Resim Yükle"}),e.jsxs(c,{type:"button",variant:"outline",onClick:()=>U(!0),disabled:w||b,children:[e.jsx(i,{className:"h-4 w-4 mr-2"}),"URL Ekle"]})]}),e.jsx(d,{open:L,onOpenChange:U,children:e.jsxs(m,{className:"sm:max-w-[425px]",children:[e.jsx(u,{children:e.jsx(g,{children:"Resim URL'si Girin"})}),e.jsx("div",{className:"py-4",children:e.jsx(p,{placeholder:"https://example.com/image.jpg",value:C,onChange:e=>_(e.target.value),className:"w-full"})}),e.jsxs(h,{children:[e.jsx(c,{variant:"outline",onClick:()=>U(!1),children:"İptal"}),e.jsx(c,{onClick:()=>{if(C&&C.trim()){try{new URL(C)}catch(e){return void a.error("Geçerli bir URL girin")}R(C),y(C),U(!1),_(""),a.success("Resim URL başarıyla eklendi")}else a.error("Geçerli bir URL girin")},disabled:b,children:"Ekle"})]})]})})]})}export{x as I};
